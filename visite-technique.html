<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Visite Technique</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #007acc;
      padding: 15px;
      color: white;
      text-align: center;
    }
    nav {
      display: flex;
      background-color: #005a99;
    }
    nav a {
      flex: 1;
      padding: 15px;
      color: white;
      text-decoration: none;
      text-align: center;
      transition: background-color 0.3s;
    }
    nav a:hover,
    nav a.active {
      background-color: #004c82;
      font-weight: bold;
    }
    main {
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    #print-btn {
      background-color: #28a745;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin-bottom: 20px;
      font-weight: bold;
      font-size: 16px;
      display: block;
      margin-left: auto;
      margin-right: auto;
      transition: background-color 0.3s;
    }
    #print-btn:hover {
      background-color: #218838;
    }
    .folder {
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 10px;
    }
    .folder-header {
      background-color: #f1f1f1;
      padding: 10px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
      font-size: 18px;
      user-select: none;
    }
    .folder-header .arrow {
      transition: transform 0.3s ease;
    }
    .folder-header.expanded .arrow {
      transform: rotate(180deg);
    }
    .folder-content {
      display: none;
      padding: 15px;
    }
    .form-group {
      margin-bottom: 10px;
    }
    label {
      display: block;
      margin-bottom: 4px;
      font-weight: bold;
    }
    input[type="text"],
    input[type="date"],
    select,
    textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      resize: vertical;
    }
    textarea {
      resize: vertical;
    }
    .section-title {
      font-weight: bold;
      color: black;
      margin-top: 20px;
      margin-bottom: 10px;
      font-size: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      user-select: none;
    }
    .section-title .arrow {
      transition: transform 0.3s ease;
    }
    .section-title.expanded .arrow {
      transform: rotate(180deg);
    }
    /* Impression */
    @media print {
      #print-btn {
        display: none !important;
      }
      .folder-header,
      .section-title {
        display: flex !important;
        background-color: transparent !important;
        color: black !important;
        -webkit-print-color-adjust: exact;
      }
      .folder-header .arrow,
      .section-title .arrow {
        display: none !important;
      }
      .folder-content {
        display: block !important;
        padding: 0 !important;
        border: none !important;
        box-shadow: none !important;
      }
      body {
        background: white !important;
        margin: 0 !important;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Visite Technique</h1>
  </header>
  <nav>
    <a href="index.html">Accueil</a>
    <a href="visite-technique.html" class="active">Visite technique</a>
    <a href="suivi-chantier.html">Suivi de chantier</a>
    <a href="mise-en-service.html">Mise en service</a>
  </nav>
  <main>
    <button id="print-btn" onclick="window.print()">üñ®Ô∏è Imprimer le dossier</button>
    <div id="folders-container"></div>
  </main>

  <script>
    const container = document.getElementById('folders-container');
    const folders = JSON.parse(localStorage.getItem('folders')) || [];

    function toggleContent(index) {
      const content = document.getElementById('content-' + index);
      const header = document.getElementById('header-' + index);
      const isOpen = content.style.display === 'block';
      content.style.display = isOpen ? 'none' : 'block';
      if (isOpen) {
        header.classList.remove('expanded');
      } else {
        header.classList.add('expanded');
      }
    }

    function toggleSection(folderIndex, sectionId) {
      const sectionContent = document.getElementById(`section-content-${folderIndex}-${sectionId}`);
      const sectionTitle = document.getElementById(`section-title-${folderIndex}-${sectionId}`);
      const isOpen = sectionContent.style.display === 'block';
      sectionContent.style.display = isOpen ? 'none' : 'block';
      if (isOpen) {
        sectionTitle.classList.remove('expanded');
      } else {
        sectionTitle.classList.add('expanded');
      }
    }

    function saveData(folderIndex, field, value) {
      folders[folderIndex].visiteTechnique = folders[folderIndex].visiteTechnique || {};
      folders[folderIndex].visiteTechnique[field] = value;
      localStorage.setItem('folders', JSON.stringify(folders));
    }

    function render() {
      container.innerHTML = '';
      folders.forEach((folder, folderIndex) => {
        const div = document.createElement('div');
        div.className = 'folder';

        const header = document.createElement('div');
        header.className = 'folder-header';
        header.id = `header-${folderIndex}`;
        header.innerHTML = `<span>${folder.name}</span><span class="arrow">‚ñº</span>`;
        header.onclick = () => toggleContent(folderIndex);

        const content = document.createElement('div');
        content.className = 'folder-content';
        content.id = 'content-' + folderIndex;

        // PLANNING
        const planningTitle = document.createElement('div');
        planningTitle.className = 'section-title';
        planningTitle.id = `section-title-${folderIndex}-planning`;
        planningTitle.innerHTML = `<span>PLANNING</span><span class="arrow">‚ñº</span>`;
        planningTitle.onclick = () => toggleSection(folderIndex, 'planning');

        const planningContent = document.createElement('div');
        planningContent.id = `section-content-${folderIndex}-planning`;
        planningContent.style.display = 'none';

        // Intervention en (date)
        const interventionGroup = document.createElement('div');
        interventionGroup.className = 'form-group';
        interventionGroup.innerHTML = '<label>Intervention en :</label>';
        const interventionInput = document.createElement('input');
        interventionInput.type = 'date';
        interventionInput.value = folder.visiteTechnique?.intervention || '';
        interventionInput.onchange = (e) => saveData(folderIndex, 'intervention', e.target.value);
        interventionGroup.appendChild(interventionInput);

        // √âquipe (textarea)
        const equipeGroup = document.createElement('div');
        equipeGroup.className = 'form-group';
        equipeGroup.innerHTML = '<label>√âquipe :</label>';
        const equipeTextarea = document.createElement('textarea');
        equipeTextarea.rows = 2;
        equipeTextarea.value = folder.visiteTechnique?.equipe || '';
        equipeTextarea.oninput = (e) => saveData(folderIndex, 'equipe', e.target.value);
        equipeGroup.appendChild(equipeTextarea);

        // Contact chef d'√©quipe (textarea)
        const contactGroup = document.createElement('div');
        contactGroup.className = 'form-group';
        contactGroup.innerHTML = '<label>Contact chef d\'√©quipe :</label>';
        const contactTextarea = document.createElement('textarea');
        contactTextarea.rows = 2;
        contactTextarea.value = folder.visiteTechnique?.contact || '';
        contactTextarea.oninput = (e) => saveData(folderIndex, 'contact', e.target.value);
        contactGroup.appendChild(contactTextarea);

        planningContent.appendChild(interventionGroup);
        planningContent.appendChild(equipeGroup);
        planningContent.appendChild(contactGroup);

        // RACCORDEMENT
        const raccordementTitle = document.createElement('div');
        raccordementTitle.className = 'section-title';
        raccordementTitle.id = `section-title-${folderIndex}-raccordement`;
        raccordementTitle.innerHTML = `<span>RACCORDEMENT</span><span class="arrow">‚ñº</span>`;
        raccordementTitle.onclick = () => toggleSection(folderIndex, 'raccordement');

        const raccordementContent = document.createElement('div');
        raccordementContent.id = `section-content-${folderIndex}-raccordement`;
        raccordementContent.style.display = 'none';

        const typeRaccordGroup = document.createElement('div');
        typeRaccordGroup.className = 'form-group';
        typeRaccordGroup.innerHTML = '<label>Type de raccordement :</label>';
        const typeRaccordSelect = document.createElement('select');
        const options = ['Vente total', 'Autoconsommation', 'Vente de surplus'];
        options.forEach(opt => {
          const optionEl = document.createElement('option');
          optionEl.value = opt;
          optionEl.textContent = opt;
          typeRaccordSelect.appendChild(optionEl);
        });
        typeRaccordSelect.value = folder.visiteTechnique?.typeRaccordement || '';
        typeRaccordSelect.onchange = (e) => saveData(folderIndex, 'typeRaccordement', e.target.value);
        typeRaccordGroup.appendChild(typeRaccordSelect);
        raccordementContent.appendChild(typeRaccordGroup);

        // PUISSANCES
        const puissancesTitle = document.createElement('div');
        puissancesTitle.className = 'section-title';
        puissancesTitle.id = `section-title-${folderIndex}-puissances`;
        puissancesTitle.innerHTML = `<span>PUISSANCES</span><span class="arrow">‚ñº</span>`;
        puissancesTitle.onclick = () => toggleSection(folderIndex, 'puissances');

        const puissancesContent = document.createElement('div');
        puissancesContent.id = `section-content-${folderIndex}-puissances`;
        puissancesContent.style.display = 'none';

        // Puissance de raccordement
        const puissanceRaccordGroup = document.createElement('div');
        puissanceRaccordGroup.className = 'form-group';
        puissanceRaccordGroup.innerHTML = '<label>Puissance de raccordement :</label>';
        const puissanceRaccordInput = document.createElement('input');
        puissanceRaccordInput.type = 'text';
        puissanceRaccordInput.value = folder.visiteTechnique?.puissanceRaccordement || '';
        puissanceRaccordInput.oninput = (e) => saveData(folderIndex, 'puissanceRaccordement', e.target.value);
        puissanceRaccordGroup.appendChild(puissanceRaccordInput);

        // Puissance de projet PV
        const puissancePVGroup = document.createElement('div');
        puissancePVGroup.className = 'form-group';
        puissancePVGroup.innerHTML = '<label>Puissance de projet PV :</label>';
        const puissancePVInput = document.createElement('input');
        puissancePVInput.type = 'text';
        puissancePVInput.value = folder.visiteTechnique?.puissanceProjetPV || '';
        puissancePVInput.oninput = (e) => saveData(folderIndex, 'puissanceProjetPV', e.target.value);
        puissancePVGroup.appendChild(puissancePVInput);

        puissancesContent.appendChild(puissanceRaccordGroup);
        puissancesContent.appendChild(puissancePVGroup);

        // TRAVAUX ENEDIS
        const travauxTitle = document.createElement('div');
        travauxTitle.className = 'section-title';
        travauxTitle.id = `section-title-${folderIndex}-travaux`;
        travauxTitle.innerHTML = `<span>TRAVAUX ENEDIS</span><span class="arrow">‚ñº</span>`;
        travauxTitle.onclick = () => toggleSection(folderIndex, 'travaux');

        const travauxContent = document.createElement('div');
        travauxContent.id = `section-content-${folderIndex}-travaux`;
        travauxContent.style.display = 'none';

        // PDL pos√©(s) lors de la VT (oui/non)
        const pdlPosesGroup = document.createElement('div');
        pdlPosesGroup.className = 'form-group';
        pdlPosesGroup.innerHTML = '<label>PDL pos√©(s) lors de la VT :</label>';
        const pdlOuiLabel = document.createElement('label');
        pdlOuiLabel.style.marginRight = '10px';
        const pdlOuiInput = document.createElement('input');
        pdlOuiInput.type = 'radio';
        pdlOuiInput.name = `pdlPoses-${folderIndex}`;
        pdlOuiInput.value = 'oui';
        pdlOuiInput.checked = folder.visiteTechnique?.pdlPoses === 'oui';
        pdlOuiInput.onchange = (e) => saveData(folderIndex, 'pdlPoses', e.target.value);
        pdlOuiLabel.appendChild(pdlOuiInput);
        pdlOuiLabel.appendChild(document.createTextNode(' Oui'));

        const pdlNonLabel = document.createElement('label');
        const pdlNonInput = document.createElement('input');
        pdlNonInput.type = 'radio';
        pdlNonInput.name = `pdlPoses-${folderIndex}`;
        pdlNonInput.value = 'non';
        pdlNonInput.checked = folder.visiteTechnique?.pdlPoses === 'non';
        pdlNonInput.onchange = (e) => saveData(folderIndex, 'pdlPoses', e.target.value);
        pdlNonLabel.appendChild(pdlNonInput);
        pdlNonLabel.appendChild(document.createTextNode(' Non'));

        pdlPosesGroup.appendChild(pdlOuiLabel);
        pdlPosesGroup.appendChild(pdlNonLabel);

        // Commentaire PDL pos√©
        const pdlCommentGroup = document.createElement('div');
        pdlCommentGroup.className = 'form-group';
        pdlCommentGroup.innerHTML = '<label>Commentaire :</label>';
        const pdlCommentTextarea = document.createElement('textarea');
        pdlCommentTextarea.rows = 2;
        pdlCommentTextarea.value = folder.visiteTechnique?.pdlCommentaire || '';
        pdlCommentTextarea.oninput = (e) => saveData(folderIndex, 'pdlCommentaire', e.target.value);
        pdlCommentGroup.appendChild(pdlCommentTextarea);

        // Nombre de PDL (select 0-3)
        const nombrePDLGroup = document.createElement('div');
        nombrePDLGroup.className = 'form-group';
        nombrePDLGroup.innerHTML = '<label>Nombre de PDL :</label>';
        const nombrePDLSelect = document.createElement('select');
        [0, 1, 2, 3].forEach(num => {
          const option = document.createElement('option');
          option.value = num;
          option.textContent = num;
          nombrePDLSelect.appendChild(option);
        });
        nombrePDLSelect.value = folder.visiteTechnique?.nombrePDL ?? 0;
        nombrePDLSelect.onchange = (e) => saveData(folderIndex, 'nombrePDL', e.target.value);
        nombrePDLGroup.appendChild(nombrePDLSelect);

        travauxContent.appendChild(pdlPosesGroup);
        travauxContent.appendChild(pdlCommentGroup);
        travauxContent.appendChild(nombrePDLGroup);

        // Assemblage des sections dans le dossier
        content.appendChild(planningTitle);
        content.appendChild(planningContent);

        content.appendChild(raccordementTitle);
        content.appendChild(raccordementContent);

        content.appendChild(puissancesTitle);
        content.appendChild(puissancesContent);

        content.appendChild(travauxTitle);
        content.appendChild(travauxContent);

        div.appendChild(header);
        div.appendChild(content);

        container.appendChild(div);
      });
    }

    if (folders.length === 0) {
      folders.push({ name: 'Dossier Exemple' });
      localStorage.setItem('folders', JSON.stringify(folders));
    }

    render();
  </script>
</body>
</html>
