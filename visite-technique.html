<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visite Technique</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; background-color: #f4f4f4; }
        header { background-color: #007acc; color: white; padding: 1em; text-align: center; }
        nav { background: #005a99; display: flex; }
        nav a {
            flex: 1; color: white; text-align: center; padding: 1em;
            text-decoration: none; border-right: 1px solid #004c82;
        }
        nav a:last-child { border-right: none; }
        nav a:hover, nav a.active { background-color: #004c82; font-weight: bold; }
        main { padding: 20px; max-width: 800px; margin: auto; }
        .dossier { background: white; margin-bottom: 10px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .dossier-header { padding: 10px; background: #e9e9e9; cursor: pointer; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .dossier-content { display: none; padding: 15px; }
        .actions { margin-top: 10px; display: flex; gap: 10px; }
        button { cursor: pointer; padding: 6px 12px; border: none; border-radius: 4px; font-weight: bold; }
        .delete-btn { background: #e74c3c; color: white; }
        .pdf-btn { background: #2ecc71; color: white; }
        input[type="date"] { padding: 5px; margin-bottom: 10px; }
        label { display: block; margin-top: 10px; }
    </style>
</head>
<body>

<header>
    <h1>Visite Technique</h1>
</header>

<nav>
    <a href="index.html">Accueil</a>
    <a href="visite-technique.html" class="active">Visite technique</a>
    <a href="suivi-chantier.html">Suivi de chantier</a>
    <a href="mise-en-service.html">Mise en service</a>
</nav>

<main id="main"></main>

<script>
    const { jsPDF } = window.jspdf;
    const main = document.getElementById('main');
    let folders = JSON.parse(localStorage.getItem('folders')) || [];

    function save() {
        localStorage.setItem('folders', JSON.stringify(folders));
    }

    function toggleContent(id) {
        const content = document.getElementById('content-' + id);
        content.style.display = content.style.display === 'none' ? 'block' : 'none';
    }

    function updateField(folderId, key, value) {
        const folder = folders.find(f => f.id === folderId);
        folder.visiteTechnique = folder.visiteTechnique || {};
        folder.visiteTechnique[key] = value;
        save();
    }

    function exportPDF(folderId) {
        const folder = folders.find(f => f.id === folderId);
        const pdf = new jsPDF();
        pdf.setFont("Arial", "normal");
        pdf.setFontSize(12);

        let y = 10;
        pdf.text(`Dossier : ${folder.name}`, 10, y);
        y += 10;
        pdf.text("Visite Technique", 10, y);
        y += 7;
        const data = folder.visiteTechnique || {};
        pdf.text(`Date : ${data.date || ''}`, 10, y); y += 7;
        pdf.text(`Sortie c창ble AC - Droite : ${data.cableDroite ? 'Oui' : 'Non'}`, 10, y); y += 7;
        pdf.text(`Sortie c창ble AC - Gauche : ${data.cableGauche ? 'Oui' : 'Non'}`, 10, y); y += 7;

        pdf.save(`Visite_Technique_${folder.name}.pdf`);
    }

    function deleteFolder(id) {
        if (confirm("Voulez-vous supprimer ce dossier ?")) {
            folders = folders.filter(f => f.id !== id);
            save();
            render();
        }
    }

    function render() {
        main.innerHTML = '';
        if (folders.length === 0) {
            main.innerHTML = '<p>Aucun dossier disponible.</p>';
            return;
        }
        folders.forEach(folder => {
            const div = document.createElement('div');
            div.className = 'dossier';

            div.innerHTML = `
                <div class="dossier-header" onclick="toggleContent(${folder.id})">
                    ${folder.name} <span>&#9660;</span>
                </div>
                <div class="dossier-content" id="content-${folder.id}">
                    <label>Date de visite technique:
                        <input type="date" value="${folder.visiteTechnique?.date || ''}" onchange="updateField(${folder.id}, 'date', this.value)">
                    </label>
                    <label><input type="checkbox" ${folder.visiteTechnique?.cableDroite ? 'checked' : ''} onchange="updateField(${folder.id}, 'cableDroite', this.checked)"> Sortie c창ble AC droite</label>
                    <label><input type="checkbox" ${folder.visiteTechnique?.cableGauche ? 'checked' : ''} onchange="updateField(${folder.id}, 'cableGauche', this.checked)"> Sortie c창ble AC gauche</label>
                    <div class="actions">
                        <button class="pdf-btn" onclick="exportPDF(${folder.id})">Exporter PDF</button>
                        <button class="delete-btn" onclick="deleteFolder(${folder.id})">Supprimer</button>
                    </div>
                </div>
            `;
            main.appendChild(div);
        });
    }

    render();
</script>

</body>
</html>
